#!/usr/bin/env sh

CWD="$(dirname "$0")"	
cd "$CWD/../"
BASE_PATH=$(pwd)

NODE_MODULES="$BASE_PATH/node_modules/"

echo "" > .version

# Needs to be updated for publishing package to npm
echo "//registry.npmjs.org/:_authToken=${NPM_TOKEN} \
always-auth=true " > .npmrc

yarn build:dist
cp .npmrc build/

# Safe switch for jenkins if we want to just try out release
# yarn release [0|1]

if [ $RELEASE_AND_PUBLISH == "1" ]; then
  echo "=== WARNING RUNNING LIVE RELEASE ==="
  $NODE_MODULES/.bin/semantic-release --debug
else
  echo "=== RUNNING TEST RELEASE. NOTHING WILL BE PUBLISHED ==="
  $NODE_MODULES/.bin/semantic-release --debug --dry-run
fi

cp .version /artifacts/.version
