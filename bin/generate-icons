#!/usr/bin/env bash

YELLOW='\033[1;33m'
NC='\033[0m' # No Color

CWD="$(dirname "$0")"
cd "$CWD/../"
BASE_PATH=$(pwd)
ICON_PATH="src/components/Icon"
ICON_FULL_PATH="$BASE_PATH/$ICON_PATH"

echo -e "Prepare index file ... \n\n"
cat /dev/null > "$ICON_FULL_PATH/index.ts"

echo "Converting svg icons into react components ..."
svgr -d $ICON_PATH --ext tsx --template $ICON_PATH/_generatorTemplate.js --expand-props start $ICON_PATH/svg

function pascalCase () {
  # Split string to 2 parts with based on first uppercased letter and upcase it
  first=`echo $1 | cut -c1 | tr [a-z] [A-Z]`
  second=`echo $1 | cut -c2-`
  echo "$first$second" | sed 's/[^_]\+/\L\u&/g' # Join both groups after splitting and pascalCase them so upload_icon => UploadIcon
}

for icon in $ICON_FULL_PATH/svg/*.svg; do
  basename=$(basename $icon | sed 's/\.svg$//');
  echo -e "Adding export statement for ${YELLOW}[$basename]${NC} ..."
  name=$(pascalCase "$basename")
  echo "export { default as $name } from './$name'" >> src/components/Icon/index.ts
done

yarn lint:path $ICON_FULL_PATH
yarn prettier-standard $ICON_FULL_PATH/**/*.tsx
